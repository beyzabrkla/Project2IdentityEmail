@model List<Project2IdentityEmail.Entities.UserMessage>
@{
    ViewData["Title"] = ViewBag.CategoryName;
    Layout = "~/Views/Shared/_MailLayout.cshtml";
    var currentUserId = ViewBag.CurrentUserId;
}

<div class="page-wrapper">
    @* Sayfa Başlığı *@
    <div class="page-breadcrumb bg-white p-3 shadow-sm border-bottom">
        <h4 class="page-title mb-0">Etiket: <span style="color: #f158d0;">@ViewBag.CategoryName</span></h4>
    </div>

    <div class="d-flex flex-row flex-grow-1 overflow-hidden">
        @await Component.InvokeAsync("MailLayoutSidebar")

        <div class="table-responsive bg-white" style="flex: 1;">

            @* --- GELEN KUTUSU BÖLÜMÜ --- *@
            <div class="p-2 px-3 bg-light border-bottom font-weight-bold text-dark d-flex align-items-center">
                <i class="mdi mdi-inbox-arrow-down mr-2 text-primary"></i> GELEN KUTUSU
            </div>
            <table class="table email-table table-hover v-middle mb-0">
                <tbody>
                    @{
                        var incoming = Model.Where(x => x.ReceiverId == currentUserId).ToList();
                    }
                    @if (!incoming.Any())
                    {
                        <tr><td class="text-center p-4 text-muted">Bu kategoride gelen mesaj yok.</td></tr>
                    }
                    else
                    {
                        @foreach (var item in incoming)
                        {
                            @* Standart Satır Yapınız (Inbox'taki <tr> yapısını buraya yapıştırın) *@
                            <tr onclick="location.href='/Mail/MailDetails/@item.Id'" style="cursor:pointer;">
                                <td class="pl-3" style="width: 40px;"><i class="far fa-star"></i></td>
                                <td>@item.Sender.Name @item.Sender.Surname</td>
                                <td class="max-texts"><b>@item.Subject</b> - @(item.Content.Length > 50 ? item.Content.Substring(0, 50) : item.Content)</td>
                                <td class="text-right pr-3">@item.Date.ToString("dd.MM.yyyy")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

            @* --- GİDEN KUTUSU BÖLÜMÜ --- *@
            <div class="p-2 px-3 bg-light border-bottom border-top font-weight-bold text-dark d-flex align-items-center">
                <i class="mdi mdi-send mr-2 text-success"></i> GİDEN KUTUSU
            </div>
            <table class="table email-table table-hover v-middle">
                <tbody>
                    @{
                        var outgoing = Model.Where(x => x.SenderId == currentUserId).ToList();
                    }
                    @if (!outgoing.Any())
                    {
                        <tr><td class="text-center p-4 text-muted">Bu kategoride gönderilen mesaj yok.</td></tr>
                    }
                    else
                    {
                        @foreach (var item in outgoing)
                        {
                            @* Standart Satır Yapınız (Outbox'taki <tr> yapısını buraya yapıştırın) *@
                            <tr onclick="location.href='/Mail/MailDetails/@item.Id'" style="cursor:pointer;">
                                <td class="pl-3" style="width: 40px;"><i class="far fa-star"></i></td>
                                <td>Kime: @item.Receiver.Name @item.Receiver.Surname</td>
                                <td class="max-texts"><b>@item.Subject</b> - @(item.Content.Length > 50 ? item.Content.Substring(0, 50) : item.Content)</td>
                                <td class="text-right pr-3">@item.Date.ToString("dd.MM.yyyy")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

        </div>
    </div>
</div>